## Good Morning!

Today:

1. Talk about Migrations and Rake
2. Write migrations to build the database for a shop
3. Maybe practice some queries if there's time

Lots of details are coming but remember: the point of migrations is to create and alter tables safely from ruby.












## Classes vs Models

### Classes

(you also may hear me talk about POROs)

1. Definition: `class Foo ... def method1 ... def method2 ... end`
2. Creation: `my_new_instance = Foo.new(maybe_some_args)`
3. Usage: `my_new_instance.method1`, `my_new_instance.method2`, etc.

### Models

The same as classes but:

1. Make sure the model subclasses `ActiveRecord::Base`
2. Do not write an initialize method!








## Models, Migrations, Schema

To have a class that can be saved in the database we have to do a few things.

1. There must be a table in the database for the model to be stored in.
2. All tables should only be created or changed through "migrations".
3. The database "schema" is the current layout of tables obtained after running all migrations.

## Rules of Migrations

The Rails Migrations Guide is pretty good. But here are some important things to remember.

1. Go in `db/migrate/` folder.
2. They should inherit from / subclass `ActiveRecord::Migration`
3. They must be _run from the command line** to take effect / change your database.
4. They **cannot** be re-run. As a result, if we want to change the database we either:
   * a) Write another migration.
   * b) "Rollback" or undo the last migration, then change the code and re-migrate.

**NOTE:** Manually changing the schema.rb file has no effect on the actual database.
The schema file is automatically generated by the migration tool and shouldn't be edited.

   






## Running Migrations

For convenience, it makes sense to have a command line tool for running migrations.

When programming, we often have many small tasks that need automating.
In ruby, we tend to use a tool called `rake` to run those tasks.
Rake uses a file called a "Rakefile" to know what tasks can be run.
It looks like this:

```ruby
require "bundler/gem_tasks"
require_relative "./config/environment"

task :console do
  Pry.start
end

namespace :db do
  # Make sure to load the DB connection
  require_relative "../config/environment"

  # This defines a task run with `rake db:migrate`
  desc "Run migrations"
  task :migrate do
    version = ENV["VERSION"] ? ENV["VERSION"].to_i : nil
    ActiveRecord::Migrator.migrate('db/migrate', version)
  end
end
```










## Let's Write Migrations!

(We might want to have a look at the schema_migrations table after running some of these.)

For these models:

### User

* id
* first name
* last name
* email

### Address

* id
* user_id
* street
* city
* state
* zip

### Item

* id
* title
* category
* description
* price

### Order

* id
* user_id
* item_id
* quantity
* ordered_at







## Last but not least

Let's practice querying! I've got some example data in this schema.

`curl -O http://redlinernotes.com/docs/databasics.sqlite3 > db/shop.db`
